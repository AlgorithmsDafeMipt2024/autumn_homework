# 6.1. RSQ и RMQ. Sparse-table.

## RSQ и RMQ

### 1. Range Sum Query (RSQ)
Задача **RSQ** заключается в том, чтобы для заданного отрезка массива \([L, R]\) найти сумму всех элементов \( A[L] + A[L+1] + \dots + A[R] \).

### 2. Range Minimum Query (RMQ)
Задача **RMQ** заключается в том, чтобы для заданного отрезка массива \([L, R]\) найти минимальный элемент среди \( A[L], A[L+1], \dots, A[R] \).

---

## Sparse-Table

**Sparse-Table** — это структура данных, которая позволяет эффективно решать задачи RMQ (и другие задачи на запросы с "идемпотентной" операцией, например, нахождение максимума).

### 1. Идея Sparse-Table
- **Предварительные вычисления**:
  - Строится таблица \( \text{sparse}[i][j] \), где \( i \) — начало отрезка, а \( j \) — длина отрезка \( 2^j \).
  - В ячейке \( \text{sparse}[i][j] \) хранится значение для отрезка длины \( 2^j \), начинающегося с индекса \( i \).

- **Обработка запроса**:
  - Разбиваем отрезок \([L, R]\) на два пересекающихся подотрезка длины \( 2^k \), где \( k \) — максимальное такое, что \( 2^k \leq R - L + 1 \).
  - Используем предвычисленные значения для ответа на запрос.

### 2. Пример заполнения таблицы
Для массива \( A = [4, 6, 1, 5, 7] \):
- \( \text{sparse}[i][0] = A[i] \) (отрезки длиной \( 2^0 = 1 \)).
- Для \( j = 1 \): \( \text{sparse}[i][1] = \min(\text{sparse}[i][0], \text{sparse}[i+1][0]) \).
- Для \( j = 2 \): \( \text{sparse}[i][2] = \min(\text{sparse}[i][1], \text{sparse}[i+2][1]) \).

---

## Построение Sparse-Table

### Алгоритм построения
1. Инициализируем таблицу для отрезков длины \( 1 \):
   - \( \text{sparse}[i][0] = A[i] \).
2. Для каждого \( j \) от \( 1 \) до \( \lfloor \log_2(n) \rfloor \):
   - \( \text{sparse}[i][j] = \min(\text{sparse}[i][j-1], \text{sparse}[i+2^{j-1}][j-1]) \).

---

## Обработка запроса RMQ с использованием Sparse-Table

### Алгоритм обработки
1. Для запроса \([L, R]\):
   - \( k = \lfloor \log_2(R - L + 1) \rfloor \).
   - Ответ: \( \min(\text{sparse}[L][k], \text{sparse}[R - 2^k + 1][k]) \).

---

## Сложность

- **Построение**:
  - \(\mathcal{O}(n \log n)\), где \( n \) — размер массива.
- **Запрос**:
  - \(\mathcal{O}(1)\), так как мы совершаем всего два обращения к таблице.

---

## Заключение

Sparse-Table является эффективной структурой для обработки RMQ, если массив остаётся неизменным. Для динамических массивов лучше использовать сегментное дерево или дерево Фенвика.
